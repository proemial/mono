---

const { title } = Astro.props;

// TODO: Replace with cookie
let status = undefined;

if (Astro.request.method === "POST") {
    try {
        const data = await Astro.request.formData();
        const name = data.get("name");
        const email = data.get("email");

        const result = await fetch(
            "https://script.google.com/macros/s/AKfycbzudweoL5CeKI9DlbZfAC-O-BLUWhHZTnxFgNbLfITjlv0gs7r3W-E1Fp0gXS8YWly8cw/exec",
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, email }),
            },
        );

        if(result.status === 200){
            status = "You are on the waitlist!";
            // Astro.cookies.set(
            //     "status",
            //     "waitlist"
            // );
        } else {
            console.error("Error: ", result.status);
        }
    } catch (error) {
        if (error instanceof Error) {
            console.error(error.message);
        }
    }

}
---
{status && <div>{status}</div>}

{!status &&
<form id="waitlist-form" method="POST">
    <input type="text" placeholder="Your name here" name="name" id="name" required>
    <input type="email" placeholder="Your email here" name="email" id="email" required>
    <button id="submit-button">Submit</button>
</form>
}

<style lang="scss">
	@import "../variables/global.scss";

  form{
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 32px;
  width: fit-content;
}

input{
  width: 325px;
  border-radius: $border-radius-standard;
  border: none;
  padding: 12px;
  font-size: $text-size-small;
  background-color:#fff;
  color: $color-inverted-text;
}

button{
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: $text-size-small;
  padding: 16px;
  border: none;
  border-radius:$border-radius-standard;
  background-color: $color-primary-brand;
  color: $color-inverted-text;
}
</style>
